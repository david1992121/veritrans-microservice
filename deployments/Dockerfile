# syntax=docker/dockerfile:1

FROM golang:1.17-alpine

WORKDIR /app

COPY ../go.mod ./
COPY ../go.sum ./

ARG MDK_API_TOKEN
ARG MDK_API_URL
ARG MERCHANT_CCID
ARG MERCHANT_PASSWORD
ARG DUMMY_REQUEST
ARG TXN_VERSION
ARG ACCOUNT_API_URL
ARG PAYMENT_API_URL
ARG SEARCH_API_URL

ENV MDK_API_TOKEN $MDK_API_TOKEN
ENV MDK_API_URL $MDK_API_URL
ENV MERCHANT_CCID $MERCHANT_CCID
ENV MERCHANT_PASSWORD $MERCHANT_PASSWORD
ENV DUMMY_REQUEST $DUMMY_REQUEST
ENV TXN_VERSION $TXN_VERSION
ENV ACCOUNT_API_URL $ACCOUNT_API_URL
ENV PAYMENT_API_URL $PAYMENT_API_URL
ENV SEARCH_API_URL $SEARCH_API_URL

RUN go mod download

COPY ../ ./

RUN go build -o /docker-veritrans-service ./cmd/main.go

EXPOSE 8080

CMD [ "/docker-veritrans-service" ]